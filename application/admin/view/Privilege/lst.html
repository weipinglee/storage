
<div class="row" id="priv_list">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-content">

                <table class="table table-striped table-bordered table-hover dataTables-example">
                    <thead>
                    <tr>
                        <th>权限名称</th>
                        <th>模块名称</th>
                        <th>控制器名称</th>
                        <th>方法名称</th>
                        <th width="120px">操作</th>
                    </tr>
                    </thead>
                    <tbody>

                    <tr class="gradeA" v-for="priv in privs" v-show="priv.show">
                        <td >
                            <span v-for="i in priv.level">
                                 &nbsp;&nbsp;
                            </span>

                            <a href="#" v-on:click="showLevel(priv.id)" v-if="priv.plus===true">
                                <span class="glyphicon glyphicon-plus"></span>
                            </a>
                            <a href="#" v-on:click="hideLevel(priv.id)" v-if="priv.plus===false">
                                <span class="glyphicon glyphicon-minus"></span>
                            </a>
                            {{priv.pri_name}}
                        </td>

                        <td>{{priv.module_name}}</td>
                        <td>{{priv.controller}}</td>
                        <td>{{priv.action_name}}</td>
                        <td class="f-14" align="center">
                            <a title="编辑"  href="{:url('edit')}" style="text-decoration:none"><i class="fa fa-edit"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                        </td>
                    </tr>

                    </tbody>

                </table>

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    var priVue = new Vue({
        el : "#priv_list",
        data : {
            init_status : 'open',//open和close,初始是关闭还是打开
            url : {
                privs_list : ''
            },
            privs : {}

        },
        methods : {
             getPrivs : function(){
                 var _this=this;
                 $.ajax({
                     type : 'GET',
                     url : this.url.privs_list,
                     dataType : 'json',
                     success : function (data) {
                         //console.log(typeof data);
                         var priv_data = data;
                         for (var index in priv_data){
                             //此处必须要用$set，否则v-if不奏效
                            // _this.$set(_this.seen, _this.privs[index]['parent_id'], _this.privs[index]['parent_id']<=0);
                             if(_this.init_status==='close'){
                                 priv_data[index].show = priv_data[index]['parent_id']<=0;//当前元素是否显示
                                 priv_data[index].plus = true;//当前元素是加号还是减号
                             }else{
                                 priv_data[index].show = true;//当前元素是否显示
                                 priv_data[index].plus = false;//当前元素是加号还是减号
                             }

                         }

                         _this.privs = priv_data;
                         _this.$forceUpdate();


                     },
                     error : function () {
                         alert('发生错误');
                     }
                 })
             },
            showLevel : function(id){
                for (var index in this.privs){
                    if(this.privs[index]['parent_id']===id){
                        this.privs[index].show = true;
                    }
                    if(this.privs[index]['id']===id){
                        this.privs[index].plus = false;
                    }
                }

            },
            hideLevel : function(id){
                for (var index in this.privs){
                    if(this.privs[index]['parent_id']===id){
                        this.privs[index].show = false;
                        //递归关闭下级权限
                        this.hideLevel(this.privs[index]['id']);
                    }
                    if(this.privs[index]['id']===id){
                        this.privs[index].plus = true;
                    }
                }
            }
        }

    });
    priVue.init_status = 'open';
    priVue.url.privs_list = "{:url('priv_list')}";
    priVue.getPrivs();





</script>



